
<!-- Users Datatable -->

<div class="card shadow my-4 mx-md-5">
  <div class="card-header py-2 px-4 d-flex justify-content-between align-items-center">
    <h6 class="m-0 font-weight-bold text-light">Usuários</h6>
    {{registerForm}}
  </div>

  <div class="card-body">
    <div class="table-responsive">
      <table class="table table-bordered" id="usersTable" width="100%" cellspacing="0">
        <thead>
          <tr>
            <th style="text-align: center">Foto</th>
            <th style="text-align: center">Nome</th>
            <th style="text-align: center">Email</th>
            <th style="text-align: center">CPF</th>
            <th style="text-align: center">Ações</th>
          </tr>
        </thead>
        <tfoot>
          <tr>
            <th style="text-align: center">Foto</th>
            <th style="text-align: center">Nome</th>
            <th style="text-align: center">Email</th>
            <th style="text-align: center">CPF</th>
            <th style="text-align: center">Ações</th>
          </tr>
        </tfoot>
        <tbody>
          {{noAdministratorsUsersTableBody}}
        </tbody>
      </table>
    </div>
  </div>
</div>


{{editForm}}


<!-- Delete User Script -->
<script>
  const deleteUserButtons = document.querySelectorAll(".delete-user-button");
  deleteUserButtons.forEach((button) =>
    button.addEventListener("click", async (e) => {
      e.preventDefault();

      Swal.fire({
        text: "Você tem certeza que deseja excluir esse usuário?",
        showCancelButton: true,
        cancelButtonText: "Cancelar",
        confirmButtonText: "Confirmar",
        position: "center"
      }).then(async (result) => {
        if (result.isConfirmed) {

          Swal.fire({
            title: "Exluindo usuário...",
            didOpen: async () => {
                Swal.showLoading();
            },
            allowOutsideClick: () => !Swal.isLoading(),
        });

          const data = await deleteUser(button.dataset.userCpf);

          Swal.fire({
            title: data.message,
            text: "",
            icon: `${data.success == true ? "success" : "error"}`,
            position: "center",
          }).then((result) => {
            if(result.isConfirmed) {
              window.location.reload();
            }
          });
        } 
      });
    })
  );


  async function deleteUser(userCpf) {
    try {
        const response = await fetch("/api/user/delete/" + userCpf, {
          method: "POST",
        });

        const data = await response.json();
        return data;

    } catch(error) {
      const data = {
        success: false,
         message: "Erro na conexão. Tente novamente."
      };
      return data;
    }
  }

</script>





<!--Set Buttons Tooltip-->
<script>

  $(document).ready(() => {
    $("#registerUserButton").tooltip();
    $(".edit-user-button").tooltip();
    $(".delete-user-button").tooltip();


    $("#registerUserModal").on("hidden.bs.modal", () => {
      //$("#registerCpf").val("");
      //$("#registerBirthDate").val("");
    });
    

    $("#editUserModal").on("hidden.bs.modal", () => {
      //$("#editLastCpf").val("");
      //$("#editCpf").val("");
      //$("#editBirthDate").val("");
    });



  });

</script>